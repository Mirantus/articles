---
title: Шаблоны проектирования
date: 2016-01-06
tags:
  - программирование
  - php
published: 1
---

Паттерны

- Описание
  - Фабричный метод
    - дает возможность подменять используемые внутри класса объекты через метод создания этих объектов и тем самым расширять класс без его изменения через создание дочерних классов, по разному реализующих этот метод, а внешний код ничего не знает про эти объекты и использует только подклассы. Например софтверная компания с обучающим центром.
    - частный 
  - Абстрактная фабрика
    - Класс, состоящий из нескольких фабричных методов. Внешний код в зависимости от окружения выбирает нужный дочерний класс, реализующий эти методы и вызывает их, получая сочетающиеся объекты с одинаковым интерфейсом, но не зная какие конкретно. Например разные виды мебели в одном стиле.
  - Строитель
    - Позволяет разбить конструктор с большим количеством параметров, вынося конструирование объекта за пределы его класса. Снаружи можно вызывать шаги по разному, создавая разные объекты одним кодом. Например конструирование дома по шагам.
    - Вынесение последовательности шагов в отдельный класс называется директором.
  - Прототип
    - Позволяет вызовом метода clone создать полную копию объекта без повторения сложного конструирования объекта, не говоря внешнему коду о классе этого объекта. Например деление клеток.
  - Одиночка, Singleton
    - Позволяет с помощью специального метода создать только один экземпляр класса, предоставляя доступ к глобальному общему ресурсу. Например президент.
  - Адаптер
    - Обертка над неизменяемым объектом для создания нужного интерфейса, скрывая от внешнего кода процесс преобразования. Например переходник.
  - Мост
    - Разделяет класс на абстракцию и несколько реализаций одного функционала, позволяя  менять их независимо и скрывая лишние детали от внешнего кода. Например телевизор и пульты.
  - Компоновщик
    - Группирует объекты в дерево и работает как с одним, рекурсивно запуская действие. Внешний код не знает количество объектов. Например подсчет цены матрешек.
  - Декоратор
    - С помощью оберток добавляет функционал неизменяемым объектам, сохраняя тот же интерфейс. Например одежда.
  - Фасад
    - Обертка над сложной системой классов, предоставляющая простой урезанный интерфейс, разделяя систему на слои и скрывая большую часть логики от внешнего кода. Пример кнопки в лифте.
  - Легковес, Приспособленец
    - Экономит память, разделяя общее состояние объектов между собой, вместо хранения одинаковых данных в каждом объекте. Применяется в программе, имеющей громадное количество одинаковых объектов. Например характеристики породы собаки в одном классе, а остальные данные конкретной собаки в другом.
  - Заместитель, Proxy
    - Перехватывает обращения к объекту, позволяя сделать что-то до или после. Реализуется классом-дублером с тем же интерфейсом. Например кэширование, логирование или проверка прав.
  - Цепочка обязанностей
    - Разбивает сложную логику класса на классы-шаги, где каждый шаг сам вызывает следующий или прерывает вызовы. Внешний код формирует цепочку и вызывает первый шаг. Можно менять последовательность шагов, не меняя класс.
    - Пример: линии поддержки.
  - Команда
    - Вызов в классе не напрямую методов другого класса, а через объект-команду, передаваемую снаружи. Это позволяет хранить историю команд, передавать и отменять их.
    - Пример: посетитель делает заказ повару через официанта
  - Итератор
    - Отделяет способ обхода коллекции от самой коллекции, позволяя подменять итераторы не меняя код. Итераторы предоставляются самой коллекцией, но могут использоваться и для обхода других. Детали коллекции скрыты от внешнего кода.
    - Пример: обход достопримечательностей с помощью разных гидов
  - Посредник, Mediator
    - Уменьшает связанность классов через класс-посредник, упрощая и позволяя переиспользовать основной класс
    - Например пилоты общаются через авиадиспетчеров
  - Снимок, Memento
    - Позволяет копировать и восстанавливать состояние класса в специальном объекте, который можно прочитать снаружи, но не изменить, сохраняя инкапсуляцию и упрощая сам класс, вынося историю во внешний код или класс-опекун.
    - Пример: команды и операция отмены
  - Наблюдатель, Observer
    - Позволяет снаружи узнавать об изменении состояния без внесения изменений в класс
    - Издатель хранит список подписчиков, дает возможность подписываться и отписываться снаружи, оповещает об изменениях
    - Пример: подписка на журналы
  - Состояние, State
    - Позволяет избавиться от условных конструкций, меняющих поведение класса
    - Ограничивает количество состояний класса, создавая отдельный класс для каждого состояния и делегируя ему работу для этого состояния
    - Пример: поведение кнопок устройства в разных состояниях
  - Стратегия
    - Позволяет избавиться от условных конструкций, меняющих поведение класса
    - Позволяет изменять поведение класса, передавая алгоритм-стратегию снаружи
    - Пример: авторизация разными способами
  - Шаблонный метод
    - Позволяет убрать дублирование методов в похожих классах, создавая набор шагов и вынося их реализацию в методы, которые можно переопределить дочерними классами
    - Пример - строительство дома, фудамент, стены, крыша
  - Посетитель, Visitor
    - Позволяет производить операцию над объектом, не изменяя его класс, а размещая новое поведение в отдельном классе, который содержит методы для каждого типа объекта, который в него передадут.
    - Наружный код вызывает одинаковый метод у всех объектов, который вызовет метод посетителя для объекта этого типа.
    - Пример: У страхового агента приготовлены полисы для разных видов организаций.

- Отличия
  - Адаптер предоставляет классу альтернативный интерфейс. Декоратор предоставляет расширенный интерфейс. Заместитель предоставляет тот же интерфейс.
  - Мост, 
  - Стратегия меняет поведение объекта «изнутри», а Декоратор изменяет его «снаружи».
  - Цепочка обязанностей передаёт запрос последовательно через цепочку потенциальных получателей, ожидая, что какой-то из них обработает запрос.
  - Цепочка обязанностей передаёт запрос последовательно через цепочку потенциальных получателей, ожидая, что какой-то из них обработает запрос.Команда устанавливает косвенную одностороннюю связь от отправителей к получателям.Посредник убирает прямую связь между отправителями и получателями, заставляя их общаться опосредованно, через себя.Наблюдатель передаёт запрос одновременно всем заинтересованным получателям, но позволяет им динамически подписываться или отписываться от таких оповещений.

- Алгоритм выбора паттерна
  - Расширять класс без его изменения
    - Фабричный метод
    - Декоратор
    - Прокси
    - Шаблонный 
    - Посетитель 
  -  интерфейс класса без его изменения
    - Фасад
    - Адаптер
  - Слишком сложный класс
    - Мост
    - Стратегия
    - Состояние 
    - Фабричный м
  - Слишком большой конструктор
    - Строитель
  - Подменять реализацию класса во время выполнения
    - Мост
    - Стратегия
  - Работать со сложной структурой
    - Компоновщик
    - Посетитель 
    - Итератор
  - Создавать единственный объект класса
    - Одиночка
  - Создавать похожие объекты
    - Строитель
    - Абстрактная фабрика
    - Прототип
  - Отделять код создания объектов от кода их использования
    - Фабричный метод
    - Абстрактная фабрика
  - Работать с запросами как с объектами 
    - Команда
    - Наблюдатель
  - Убрать зависимость между вызовом и обработчиком 
    - Цепочка обязанностей 
    - Команда 
    - Прокси
    - Наблюдатель
    - Посредник 
  - Экономить память
    - Легковес 
    - Прокси
  - Реализовать отмену
    - Команда 
    - Снимок
  - Сохранять 
    - Снимок
    - Прототип

порождающие шаблоны
<div><strong>Абстрактная фабрика (Abstract factory)</strong></div>
<div><a href="http://m15.ru/pattern_abstract_factory_in_php" target="_blank" shape="rect">http://m15.ru/pattern_abstract_factory_in_php</a></div>
<div>Класс, который представляет собой интерфейс для создания компонентов системы.</div>
<div>Генерация связанных наборов классов</div>
<div><em>GrantaFactory extends VazFactory</em></div>
<div><em>GrantaSedan extends Sedan // Класс Sedan связан с VazFactory через GrantaFactory и GrantaSedan </em></div>
<div><em>$grantaSedan = $grantaFactory-&gt;getSedan();</em></div>
<div><em>$grantaSedan-&gt;getSpeed(); // фабричный метод</em></div>
<div><em>$uazJeep-&gt;getSpeed();</em></div>
<div>

<hr />

<div>
<div>Строитель (Builder)</div>
<div>

<hr />

</div>
<div><strong>Фабричный метод (Factory method)</strong></div>
<div>Определяет интерфейс для создания объекта, но оставляет подклассам решение о том, какой класс инстанцировать.</div>
<div>Полиморфизм.</div>
<div><em>VazFactory extends CarFactory</em></div>
<div><em>$granta = $vazFactoryObj-&gt;getCar();</em></div>
<div><em>$granta-&gt;getSpeed(); // одинаковый вызов</em></div>
<div><em>$kamaz-&gt;getSpeed(); // у разных похожих объектов</em></div>

<hr />

<div>Отложенная инициализация (Lazy initialization)</div>

<hr />

<div>Пул одиночек (Multition)</div>

<hr />

<div>Объектный пул (Object pool)</div>

<hr />

<div><strong>Прототип (Prototype)</strong></div>
<div>Определяет интерфейс создания объекта через клонирование другого объекта вместо создания через конструктор.</div>
<div>Клонирование.</div>
<div>Один класс для генерации разных типов. Типы сами определяют, что генерируется.</div>
<div><em>Granta extends Car</em></div>
<div><em>Kalina extends Car</em></div>
<div><em>$carFactory = new CarFactory($granta, $kalina, ...)</em></div>
<div><em>$granta2 = $carFactory-&gt;getGranta() // clone granta</em></div>

<hr />

<div>Получение ресурса есть инициализация (Resource acquisition is initialization)</div>
<div>

<hr />

</div>
<div><strong>Одиночка (Singleton)</strong></div>
<div>Класс, который может иметь только один экземпляр.</div>
<div><em>Car::getInstance()-&gt;getSpeed();</em></div>
</div>
</div>
<div></div>
<div>поведенческие шаблоны</div>
<div></div>
<div>
<div>Цепочка ответственности (Chain of responsibility)</div>

<hr />

<div><strong>Команда</strong>, Action, Transaction <strong>(Command)</strong></div>
<div>Представляет действие. Объект команды заключает в себе само действие и его параметры.
Отделяет контроллер от модели, создает легко расширяемые системы.</div>
<div>Инкапсулирование задач.</div>
<div><em>$car-&gt;buy();</em></div>
<div><em>function buy() {</em></div>
<div><em> $car-&gt;execute();</em></div>
<div><em>}</em>

<hr />

<strong>Интерпретатор (Interpreter)</strong>
<div>Решает часто встречающуюся, но подверженную изменениям, задачу.</div>
<div>Интерпретатор языка.</div>
<div>Выполнение команд на уровне классов.</div>
<div>- количество классов</div>
<div><em>new CarCompare(new Granta(), new Kalina());</em>

<hr />

Итератор, Cursor (Iterator)

<hr />

Посредник (Mediator)

<hr />

Хранитель, Token (Memento)

<hr />

Null Object (Null object)

<hr />

<strong>Наблюдатель</strong>, Dependents, Publish-Subscribe, Listener (<strong>Observer</strong> или Publish/subscribe)</div>
<div>Определяет зависимость типа «один ко многим» между объектами таким образом, что при изменении состояния одного объекта все зависящие от него оповещаются об этом событии.</div>
<div>Изменение компонентов с минимальным воздействием на другие компоненты.</div>
<div><em>$car = new Car();</em></div>
<div><em>$carInfo = new CarInfo($car);</em></div>
<div><em>$car-&gt;set('price', 300);</em></div>
<div><em>$carInfo-&gt;alertChange($price, $value);</em>

<hr />

Слуга (Servant)

<hr />

Спецификация (Specification)

<hr />

Состояние, Objects for States (State)

<hr />

<strong>Стратегия (Strategy)</strong></div>
<div>Предназначен для определения семейства алгоритмов, инкапсуляции каждого из них и обеспечения их взаимозаменяемости.</div>
<div>Декомпозиция на подклассы.</div>
<div>Отделение разных поведений от одного класса.</div>
<div>Выделение общего алгоритма дочерних классов в отдельный класс.</div>
<div><em>$cars = [new Granta(), new Kalina()];</em></div>
<div><em>foreach ($cars) {</em></div>
<div><em> $statistic = new Statistic($car);</em></div>
<div><em> $statistic-&gt;getInfo();</em></div>
<div><em>}</em>

<hr />

Шаблонный метод (Template method)

<hr />

<strong>Посетитель (Visitor)</strong></div>
<div>Описывает операцию, которая выполняется над объектами других классов. При изменении класса Visitor нет необходимости изменять обслуживаемые классы.</div>
<div>Лёгкое прохождение по дереву без раздутия интерфейса.</div>
<div><em>$cars = new Cars();</em></div>
<div><em>$cars-&gt; add(new Granta);</em></div>
<div><em>$carInfo = new CarInfo();</em></div>
<div><em>$cars-&gt;accept($carInfo);</em></div>
<div><em>$carInfo-&gt;getInfo();</em>

<hr />

Простая политика (Simple Policy)

<hr />

Event listener

<hr />

Single-serving visitor (Single-serving visitor)

<hr />

Hierarchical visitor (Hierarchical visitor)</div>
</div>
</div>
<div></div>
<div>структурные шаблоны</div>
<div></div>
<div>
<div>Адаптер (Adapter/Wrapper)</div>

<hr />

<div>Мост (Bridge)</div>

<hr />

<div><strong>Компоновщик (Composite)</strong></div>
<div>Объект, который объединяет в себе объекты, подобные ему самому.</div>
<div>Объединение и управление группами схожих объектов.</div>
<div>- нет информации о всех операциях делегирования</div>
<div>- лишние операции</div>
<div><em>$cars = new Cars();</em></div>
<div><em>$cars-&gt;add($granta);</em></div>
<div><em>$cars-&gt;add($kalina);</em></div>
<div><em>$cars-&gt;getMaxSpeed();</em>

<hr />

<strong>Декоратор (Decorator)</strong></div>
<div>Класс, расширяющий функциональность другого класса без использования наследования.
Изменяет свойства конкретных объектов.</div>
<div>Делегирование.</div>
<div><em>$granta = new Granta();</em></div>
<div><em>$granta-&gt;getPrice(); // 300</em></div>
<div><em>$granta = new Sport($granta) ;</em></div>
<div>
<div><em>$granta-&gt;getPrice(); <a>// 800</a></em></div>

<hr />

<strong>Фасад (Facade)</strong></div>
<div>Объект, который абстрагирует работу с несколькими классами, объединяя их в единое целое.</div>
<div>Шлюз между системой и кодом.</div>
<div>Одна точка входа, оболочка.</div>
<div><em>$info = new CarInfo();</em></div>
<div><em>$info-&gt;getCar('Granta');</em></div>
<div>

<hr />

Единая точка входа (Front Controller)

<hr />

Приспособленец (Flyweight)

<hr />

Заместитель (Proxy)</div>
</div>
